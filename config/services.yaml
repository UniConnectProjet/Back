services:
    _defaults:
        autowire: true
        autoconfigure: true

    # Charger tous les services de src/
    App\:
        resource: '../src/*'
        exclude: '../src/{DependencyInjection,Entity,Tests,Kernel.php}'

    # Charger aussi les contr√¥leurs comme services
    App\Controller\:
        resource: '../src/Controller'
        tags: ['controller.service_arguments']

    # Prometheus services
    Prometheus\Storage\Adapter:
        class: Prometheus\Storage\InMemory

    Prometheus\CollectorRegistry:
        arguments: ['@Prometheus\Storage\Adapter']

    App\EventSubscriber\HttpMetricsSubscriber:
        arguments: ['@Prometheus\CollectorRegistry']
        tags: ['kernel.event_subscriber']
    
    when@dev:
    services:
        Doctrine\Common\DataFixtures\Loader: '@doctrine.fixtures.loader'
    when@test:
        services:
            Doctrine\Common\DataFixtures\Loader: '@doctrine.fixtures.loader'


